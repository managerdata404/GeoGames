<!DOCTYPE html>
<html>
<head>
    <title>Enhanced Geological Structure Simulator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #simulationCanvas {
            border: 1px solid #ccc;
            margin: 20px 0;
            background-color: #fff;
        }
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: center;
        }
        select, button {
            padding: 8px;
            font-size: 16px;
        }
        select {
            width: 200px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .info-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .stage-info, .process-info {
            padding: 15px;
            background-color: #f8f8f8;
            border-radius: 4px;
        }
        .legend {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        #stageCounter {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }
        .vector-info {
            margin-top: 10px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Advanced Geological Structure Simulator</h1>
        
        <div class="controls">
            <select id="structureSelect" onchange="initSimulation()">
                <option value="thinBeds">Thin Beds</option>
                <option value="thrustFaults">Thrust Faults</option>
                <option value="pinchOut">Pinch Out</option>
                <option value="saltDome">Salt Dome</option>
                <option value="carbonateWedges">Carbonate Wedges</option>
                <option value="sigmoidalPattern">Sigmoidal Pattern</option>
                <option value="toplaps">Toplaps</option>
                <option value="baselaps">Baselaps</option>
                <option value="imbricatedStructures">Imbricated Structures</option>
                <option value="deltaicDeposit">Deltaic Deposit</option>
                <option value="channelFill">Channel Fill Deposit</option>
                <option value="reefComplexes">Reef Complexes</option>
                <option value="volcanicFeatures">Volcanic Sills and Dikes</option>
            </select>
            <button onclick="previousStage()">Previous Stage</button>
            <button onclick="nextStage()">Next Stage</button>
            <button onclick="playAnimation()">Play Animation</button>
            <button onclick="pauseAnimation()">Pause</button>
            <button onclick="resetSimulation()">Reset</button>
            <span id="stageCounter">Stage: 1/5</span>
        </div>

        <canvas id="simulationCanvas" width="800" height="400"></canvas>
        
        <div class="legend" id="legend"></div>
        
        <div class="info-panel">
            <div class="stage-info">
                <h3>Stage Information</h3>
                <div id="stageInfo"></div>
                <div class="vector-info" id="vectorInfo"></div>
            </div>
            <div class="process-info">
                <h3>Formation Process</h3>
                <div id="processInfo"></div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simulationCanvas');
        const ctx = canvas.getContext('2d');
        let currentStage = 1;
        let maxStages = 5;
        let animationFrame;
        let isPlaying = false;
        let time = 0;

        const colors = {
            sandstone: '#FFE4B5',
            shale: '#708090',
            limestone: '#DCDCDC',
            salt: '#FFFFFF',
            basalt: '#4A4A4A',
            metamorphic: '#B8860B'
        };

        function drawArrow(ctx, fromX, fromY, toX, toY, color = '#FF0000') {
            const headLength = 15;
            const angle = Math.atan2(toY - fromY, toX - fromX);
            
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.lineTo(toX - headLength * Math.cos(angle - Math.PI / 6), toY - headLength * Math.sin(angle - Math.PI / 6));
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headLength * Math.cos(angle + Math.PI / 6), toY - headLength * Math.sin(angle + Math.PI / 6));
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.lineWidth = 1;
        }

        const structureInfo = {
            thrustFaults: {
                stages: [
                    {
                        draw: (ctx) => {
                            // Initial horizontal layers
                            for(let i = 0; i < 5; i++) {
                                ctx.beginPath();
                                ctx.moveTo(0, 200 + i * 30);
                                ctx.lineTo(800, 200 + i * 30);
                                ctx.strokeStyle = Object.values(colors)[i % Object.keys(colors).length];
                                ctx.lineWidth = 20;
                                ctx.stroke();
                                ctx.lineWidth = 1;
                            }
                        },
                        info: "Initial horizontal sedimentary layers deposited over time",
                        process: "Sedimentary layers are deposited horizontally following the principle of original horizontality",
                        vectors: []
                    },
                    {
                        draw: (ctx) => {
                            // Beginning of compression
                            for(let i = 0; i < 5; i++) {
                                ctx.beginPath();
                                ctx.moveTo(0, 200 + i * 30);
                                ctx.lineTo(400, 180 + i * 30);
                                ctx.lineTo(800, 200 + i * 30);
                                ctx.strokeStyle = Object.values(colors)[i % Object.keys(colors).length];
                                ctx.lineWidth = 20;
                                ctx.stroke();
                                ctx.lineWidth = 1;
                            }
                            drawArrow(ctx, 0, 350, 100, 350);
                            drawArrow(ctx, 800, 350, 700, 350);
                        },
                        info: "Compressional forces begin to affect the layers",
                        process: "Tectonic compression begins to deform the originally horizontal layers",
                        vectors: ["Compression from both sides"]
                    },
                    {
                        draw: (ctx) => {
                            // Formation of fault plane
                            for(let i = 0; i < 5; i++) {
                                ctx.beginPath();
                                ctx.moveTo(0, 200 + i * 30);
                                ctx.lineTo(300, 150 + i * 30);
                                ctx.lineTo(800, 200 + i * 30);
                                ctx.strokeStyle = Object.values(colors)[i % Object.keys(colors).length];
                                ctx.lineWidth = 20;
                                ctx.stroke();
                                ctx.lineWidth = 1;
                            }
                            ctx.beginPath();
                            ctx.moveTo(200, 100);
                            ctx.lineTo(400, 300);
                            ctx.strokeStyle = '#FF0000';
                            ctx.setLineDash([5, 5]);
                            ctx.stroke();
                            ctx.setLineDash([]);
                            
                            drawArrow(ctx, 0, 350, 100, 350);
                            drawArrow(ctx, 800, 350, 700, 350);
                        },
                        info: "Development of fault plane",
                        process: "Continued compression leads to formation of a thrust fault plane",
                        vectors: ["Compression continues", "Fault plane develops at ~30Â° angle"]
                    },
                    {
                        draw: (ctx) => {
                            // Movement along fault
                            ctx.beginPath();
                            ctx.moveTo(200, 100);
                            ctx.lineTo(400, 300);
                            ctx.strokeStyle = '#FF0000';
                            ctx.setLineDash([5, 5]);
                            ctx.stroke();
                            ctx.setLineDash([]);
                            
                            // Upper block
                            for(let i = 0; i < 5; i++) {
                                ctx.beginPath();
                                ctx.moveTo(0, 150 + i * 30);
                                ctx.lineTo(300, 100 + i * 30);
                                ctx.lineTo(500, 150 + i * 30);
                                ctx.strokeStyle = Object.values(colors)[i % Object.keys(colors).length];
                                ctx.lineWidth = 20;
                                ctx.stroke();
                                ctx.lineWidth = 1;
                            }
                            
                            // Lower block
                            for(let i = 0; i < 5; i++) {
                                ctx.beginPath();
                                ctx.moveTo(300, 200 + i * 30);
                                ctx.lineTo(800, 200 + i * 30);
                                ctx.strokeStyle = Object.values(colors)[i % Object.keys(colors).length];
                                ctx.lineWidth = 20;
                                ctx.stroke();
                                ctx.lineWidth = 1;
                            }
                            
                            drawArrow(ctx, 250, 150, 350, 100);
                        },
                        info: "Movement along thrust fault",
                        process: "Upper block moves up and over lower block along fault plane",
                        vectors: ["Upward movement of hanging wall", "Continued compression"]
                    },
                    {
                        draw: (ctx) => {
                            // Final thrust fault configuration
                            ctx.beginPath();
                            ctx.moveTo(200, 100);
                            ctx.lineTo(400, 300);
                            ctx.strokeStyle = '#FF0000';
                            ctx.setLineDash([5, 5]);
                            ctx.stroke();
                            ctx.setLineDash([]);
                            
                            // Upper block
                            for(let i = 0; i < 5; i++) {
                                ctx.beginPath();
                                ctx.moveTo(0, 120 + i * 30);
                                ctx.lineTo(300, 70 + i * 30);
                                ctx.lineTo(600, 120 + i * 30);
                                ctx.strokeStyle = Object.values(colors)[i % Object.keys(colors).length];
                                ctx.lineWidth = 20;
                                ctx.stroke();
                                ctx.lineWidth = 1;
                            }
                            
                            // Lower block
                            for(let i = 0; i < 5; i++) {
                                ctx.beginPath();
                                ctx.moveTo(300, 200 + i * 30);
                                ctx.lineTo(800, 200 + i * 30);
                                ctx.strokeStyle = Object.values(colors)[i % Object.keys(colors).length];
                                ctx.lineWidth = 20;
                                ctx.stroke();
                                ctx.lineWidth = 1;
                            }
                        },
                        info: "Final thrust fault structure",
                        process: "Complete thrust fault showing older rocks pushed up and over younger rocks",
                        vectors: ["Displacement complete", "Structural overturning"]
                    }
                ]
            },
            saltDome: {
                stages: [
                    {
                        draw: (ctx) => {
                            // Initial flat layers with salt at bottom
                            for(let i = 0; i < 6; i++) {
                                ctx.beginPath();
                                ctx.moveTo(0, 150 + i * 40);
                                ctx.lineTo(800, 150 + i * 40);
                                ctx.strokeStyle = i === 5 ? colors.salt : Object.values(colors)[i % (Object.keys(colors).length - 1)];
                                ctx.lineWidth = 35;
                                ctx.stroke();
                                ctx.lineWidth = 1;
                            }
                        },
                        info: "Initial horizontal sedimentary layers with salt layer at base",
                        process: "Salt deposited during evaporation, followed by sedimentary layers",
                        vectors: []
                    },
                    {
                        draw: (ctx) => {
                            // Beginning of salt movement
                            for(let i = 0; i < 6; i++) {
                                if(i === 5) {
                                    // Salt layer with slight dome
                                    ctx.beginPath();
                                    ctx.moveTo(0, 350);
                                    ctx.quadraticCurveTo(400, 320, 800, 350);
                                    ctx.strokeStyle = colors.salt;
                                    ctx.lineWidth = 35;
                                    ctx.stroke();
                                    ctx.lineWidth = 1;
                                } else {
                                    // Other layers
                                    ctx.beginPath();
                                    ctx.moveTo(0, 150 + i * 40);
                                    ctx.quadraticCurveTo(400, 140 + i * 40, 800, 150 + i * 40);
                                    ctx.strokeStyle = Object.values(colors)[i % (Object.keys(colors).length - 1)];
                                    ctx.lineWidth = 35;
                                    ctx.stroke();
                                    ctx.lineWidth = 1;
                                }
                            }
                            drawArrow(ctx, 400, 350, 400, 300);
                        },
                        info: "Salt begins to rise due to density differences",
                        process: "Buoyant force causes salt to move upward through denser overlying rocks",
                        vectors: ["Upward salt movement"]
                    },
                    {
                        draw: (ctx) => {
                            // Developing salt dome
                            // Salt dome
                            ctx.beginPath();
                            ctx.moveTo(300, 350);
                            ctx.quadraticCurveTo(400, 200, 500, 350);
                            ctx.fillStyle = colors.salt;
                            ctx.fill();