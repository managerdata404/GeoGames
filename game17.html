<!DOCTYPE html>
<html>
<head>
    <title>Geology AR Explorer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.2/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow/4.10.0/tf.min.js"></script>
    <style>
        .ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .score-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: Arial, sans-serif;
        }

        .info-panel {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            max-width: 80%;
            font-family: Arial, sans-serif;
        }

        .control-panel {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 10px;
            pointer-events: auto;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        button:disabled {
            background: #cccccc;
        }

        .detection-box {
            position: fixed;
            border: 2px solid #4CAF50;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <div id="loading-screen">
        <div style="text-align: center;">
            <h2>Loading Geology Explorer...</h2>
            <p>Please allow camera access when prompted</p>
        </div>
    </div>

    <div class="ui-overlay">
        <div class="score-panel">
            Score: <span id="score">0</span><br>
            Discoveries: <span id="discoveries">0</span>/5
        </div>
        <div id="info" class="info-panel">
            Point your camera at rocks, mountains, or geological formations
        </div>
        <div class="control-panel">
            <button onclick="startDetection()" id="startBtn">Start Exploration</button>
            <button onclick="toggleAR()" id="arBtn" disabled>Show AR Info</button>
        </div>
    </div>

    <a-scene embedded vr-mode-ui="enabled: false">
        <a-camera position="0 1.6 0"></a-camera>
        
        <!-- AR Information Overlays -->
        <a-entity id="ar-overlays" visible="false">
            <!-- Rock Formation Info -->
            <a-entity id="rock-info" visible="false" position="0 0 -5">
                <a-plane color="#000" opacity="0.8" height="2" width="3">
                    <a-text value="Rock Formation" align="center" position="0 0.7 0.01"></a-text>
                    <a-text value="Age: ~150 million years\nType: Sedimentary\nComposition: Limestone" 
                            align="left" position="-1.3 0 0.01" width="2.5"></a-text>
                </a-plane>
            </a-entity>

            <!-- Mountain Info -->
            <a-entity id="mountain-info" visible="false" position="0 0 -5">
                <a-plane color="#000" opacity="0.8" height="2" width="3">
                    <a-text value="Mountain Formation" align="center" position="0 0.7 0.01"></a-text>
                    <a-text value="Type: Fold Mountain\nFormation: Tectonic Activity\nAge: 65 million years" 
                            align="left" position="-1.3 0 0.01" width="2.5"></a-text>
                </a-plane>
            </a-entity>

            <!-- Mineral Info -->
            <a-entity id="mineral-info" visible="false" position="0 0 -5">
                <a-plane color="#000" opacity="0.8" height="2" width="3">
                    <a-text value="Mineral Deposit" align="center" position="0 0.7 0.01"></a-text>
                    <a-text value="Type: Quartz\nHardness: 7\nSystem: Hexagonal" 
                            align="left" position="-1.3 0 0.01" width="2.5"></a-text>
                </a-plane>
            </a-entity>
        </a-entity>
    </a-scene>

    <script>
        let score = 0;
        let discoveries = 0;
        let isDetecting = false;
        let model = null;
        const detectedObjects = new Set();

        // Simulated geology features for detection
        const geologyFeatures = {
            rock: { name: 'Rock Formation', points: 10 },
            mountain: { name: 'Mountain', points: 20 },
            mineral: { name: 'Mineral Deposit', points: 15 }
        };

        async function loadModel() {
            try {
                // In a real implementation, this would load a proper TensorFlow.js model
                // Here we're simulating the model loading
                await new Promise(resolve => setTimeout(resolve, 2000));
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('startBtn').disabled = false;
            } catch (error) {
                console.error('Error loading model:', error);
                document.getElementById('info').textContent = 'Error loading detection model. Please refresh.';
            }
        }

        function startDetection() {
            isDetecting = true;
            document.getElementById('arBtn').disabled = false;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('info').textContent = 'Scanning for geological features...';
            
            // Start simulated detection
            runDetection();
        }

        function toggleAR() {
            const overlays = document.getElementById('ar-overlays');
            overlays.setAttribute('visible', !overlays.getAttribute('visible'));
        }

        function updateScore(points) {
            score += points;
            discoveries++;
            document.getElementById('score').textContent = score;
            document.getElementById('discoveries').textContent = discoveries;
        }

        function showFeatureInfo(feature) {
            // Hide all info panels
            document.querySelectorAll('[id$="-info"]').forEach(el => el.setAttribute('visible', false));
            
            // Show specific feature info
            const infoPanel = document.getElementById(`${feature}-info`);
            if (infoPanel) {
                infoPanel.setAttribute('visible', true);
            }
        }

        function runDetection() {
            if (!isDetecting) return;

            // Simulate random feature detection
            if (Math.random() < 0.3 && discoveries < 5) {
                const features = Object.keys(geologyFeatures);
                const detectedFeature = features[Math.floor(Math.random() * features.length)];
                
                if (!detectedObjects.has(detectedFeature)) {
                    detectedObjects.add(detectedFeature);
                    const feature = geologyFeatures[detectedFeature];
                    updateScore(feature.points);
                    showFeatureInfo(detectedFeature);
                    
                    document.getElementById('info').textContent = 
                        `Discovered: ${feature.name}! +${feature.points} points`;
                }
            }

            // Continue detection loop
            if (discoveries < 5) {
                requestAnimationFrame(runDetection);
            } else {
                document.getElementById('info').textContent = 
                    'Exploration complete! You\'ve discovered all major features!';
                isDetecting = false;
            }
        }

        // Initialize
        loadModel();
    </script>
</body>
</html>