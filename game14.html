<!DOCTYPE html>
<html>
<head>
    <title>Anticline Failure Simulation</title>
    <style>
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            background: white;
            padding: 15px;
            border-radius: 8px;
        }
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background-color: #2563eb;
            color: white;
            cursor: pointer;
        }
        select {
            padding: 5px;
            border-radius: 4px;
        }
        .legend {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border: 1px solid #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <svg id="geology" width="600" height="400">
            <rect width="600" height="400" fill="#f0f0f0"/>
            <g id="reservoir"></g>
            <g id="layers"></g>
            <g id="fault"></g>
            <g id="particles"></g>
        </svg>

        <div class="controls">
            <select id="faultType" onchange="updateFault()">
                <option value="normal">Normal Fault</option>
                <option value="reverse">Reverse Fault</option>
                <option value="strike-slip">Strike-Slip Fault</option>
            </select>
            <button onclick="startAnimation()">Start Animation</button>
            <button onclick="resetAnimation()">Reset</button>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #FFE5B4"></div>
                <span>Reservoir Rock</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #444444"></div>
                <span>Cap Rock</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #000000"></div>
                <span>Oil</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #FFD700"></div>
                <span>Gas</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #4169E1"></div>
                <span>Water</span>
            </div>
        </div>
    </div>

    <script>
        const svg = document.getElementById('geology');
        let progress = 0;
        let animationFrame;
        let faultType = 'normal';

        // Create initial layers
        function createLayers() {
            const reservoir = document.getElementById('reservoir');
            const layers = document.getElementById('layers');
            const fault = document.getElementById('fault');

            reservoir.innerHTML = '';
            layers.innerHTML = '';
            fault.innerHTML = '';

            // Create reservoir rock
            const reservoirPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            reservoirPath.setAttribute('d', createLayerPath(0, 40));
            reservoirPath.setAttribute('fill', 'none');
            reservoirPath.setAttribute('stroke', '#FFE5B4');
            reservoirPath.setAttribute('stroke-width', '40');
            reservoir.appendChild(reservoirPath);

            // Create cap rock layers
            for (let i = 0; i < 5; i++) {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', createLayerPath(i * 20 - 60, 3));
                path.setAttribute('fill', 'none');
                path.setAttribute('stroke', `rgb(${68 + i * 20}, ${68 + i * 20}, ${68 + i * 20})`);
                path.setAttribute('stroke-width', '3');
                layers.appendChild(path);
            }

            // Create fault line
            const faultLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            faultLine.setAttribute('x1', '300');
            faultLine.setAttribute('y1', '100');
            faultLine.setAttribute('x2', '300');
            faultLine.setAttribute('y2', '300');
            faultLine.setAttribute('stroke', 'red');
            faultLine.setAttribute('stroke-width', '3');
            faultLine.setAttribute('stroke-dasharray', '5,5');
            faultLine.setAttribute('opacity', '0');
            fault.appendChild(faultLine);
        }

        function createLayerPath(offset, width) {
            const points = [];
            for (let x = 0; x <= 600; x += 10) {
                const y = 200 + offset + Math.sin((x - 300) / 100) * 50;
                points.push(`${x},${y}`);
            }
            return `M${points.join(' L')}`;
        }

        function updateLayers() {
            const faultLine = fault.querySelector('line');
            faultLine.setAttribute('opacity', progress);

            const allPaths = [...reservoir.getElementsByTagName('path'), 
                            ...layers.getElementsByTagName('path')];

            allPaths.forEach((path, i) => {
                const offset = (i - 1) * 20 - 60;
                const points = [];

                for (let x = 0; x <= 600; x += 10) {
                    let y = 200 + offset + Math.sin((x - 300) / 100) * 50;

                    if (x > 300) {
                        switch(faultType) {
                            case 'normal':
                                y += progress * 50;
                                break;
                            case 'reverse':
                                y -= progress * 50;
                                break;
                            case 'strike-slip':
                                x += progress * 20;
                                break;
                        }
                    }
                    points.push(`${x},${y}`);
                }

                path.setAttribute('d', `M${points.join(' L')}`);
            });
        }

        function animate() {
            if (progress >= 1) {
                cancelAnimationFrame(animationFrame);
                return;
            }

            progress += 0.01;
            updateLayers();
            animationFrame = requestAnimationFrame(animate);
        }

        function updateFault() {
            faultType = document.getElementById('faultType').value;
            if (progress > 0) {
                updateLayers();
            }
        }

        function startAnimation() {
            if (progress < 1) {
                animate();
            }
        }

        function resetAnimation() {
            progress = 0;
            cancelAnimationFrame(animationFrame);
            createLayers();
        }

        // Initialize on load
        createLayers();
    </script>
</body>
</html>