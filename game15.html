<!DOCTYPE html>
<html>
<head>
    <title>Anticline Failure Simulation with Adjustable Fault</title>
    <style>
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 8px;
        }
        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background-color: #2563eb;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #1d4ed8;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 10px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border: 1px solid #333;
        }
        select, input {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        label {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <svg id="geology" width="600" height="400" viewBox="0 0 600 400">
            <!-- Background -->
            <rect width="600" height="400" fill="#f0f0f0"/>

            <!-- Reservoir rock layer -->
            <g id="reservoir"></g>

            <!-- Hydrocarbons -->
            <g id="hydrocarbons"></g>

            <!-- Cap rock layers -->
            <g id="layers"></g>

            <!-- Fault line -->
            <path id="fault" d="M300,100 L300,300" 
                  stroke="red" 
                  stroke-width="3" 
                  stroke-dasharray="5,5" 
                  opacity="0"/>

            <!-- Fluid particles -->
            <g id="particles"></g>
        </svg>
        <div class="controls">
            <div class="control-group">
                <label>Fault Type:</label>
                <select id="faultType" onchange="updateFaultParameters()">
                    <option value="normal">Normal Fault</option>
                    <option value="reverse">Reverse Fault</option>
                    <option value="strike-slip">Strike-Slip Fault</option>
                </select>
            </div>
            <div class="control-group">
                <label>Fault Angle:</label>
                <input type="range" id="faultAngle" min="30" max="150" value="90" 
                       onchange="updateFaultParameters()">
                <span id="angleValue">90°</span>
            </div>
            <div class="control-group">
                <label>Displacement Magnitude:</label>
                <input type="range" id="displacement" min="20" max="100" value="50" 
                       onchange="updateFaultParameters()">
                <span id="displaceValue">50</span>
            </div>
            <div class="control-group">
                <button onclick="startAnimation()">Start Animation</button>
                <button onclick="resetAnimation()">Reset</button>
            </div>
        </div>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #FFE5B4"></div>
                <span>Reservoir Rock</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #444444"></div>
                <span>Cap Rock</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #000000"></div>
                <span>Oil</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #FFD700"></div>
                <span>Gas</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #4169E1"></div>
                <span>Water</span>
            </div>
        </div>
    </div>

    <script>
        const numLayers = 5;
        const colors = [
            '#444444', '#555555', '#666666', '#777777', '#888888'
        ];

        let paths = [];
        let animationFrame;
        let progress = 0;
        let particles = [];
        let faultParams = {
            type: 'normal',
            angle: 90,
            displacement: 50
        };

        class Particle {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.type = type;
                this.dx = (Math.random() - 0.5) * 2;
                this.dy = (Math.random() - 0.5) * 2;

                switch(type) {
                    case 'gas':
                        this.color = '#FFD700';
                        this.radius = 3;
                        break;
                    case 'oil':
                        this.color = '#000000';
                        this.radius = 4;
                        break;
                    case 'water':
                        this.color = '#4169E1';
                        this.radius = 4;
                        break;
                }
            }

            update() {
                if (this.type === 'gas') {
                    this.dy -= 0.1;
                } else if (this.type === 'water') {
                    this.dy += 0.05;
                }

                this.x += this.dx * progress;
                this.y += this.dy;

                const yBase = 200 + Math.sin((this.x - 300) / 100) * 50;
                if (this.y < yBase - 30) this.y = yBase - 30;
                if (this.y > yBase + 30) this.y = yBase + 30;
                if (this.x < 100) this.x = 100;
                if (this.x > 500) this.x = 500;
            }
        }

        function updateFaultParameters() {
            faultParams.type = document.getElementById('faultType').value;
            faultParams.angle = parseInt(document.getElementById('faultAngle').value);
            faultParams.displacement = parseInt(document.getElementById('displacement').value);

            document.getElementById('angleValue').textContent = faultParams.angle + '°';
            document.getElementById('displaceValue').textContent = faultParams.displacement;

            updateFaultLine();
            if (progress > 0) {
                updateLayers();
            }
        }

        function updateFaultLine() {
            const fault = document.getElementById('fault');
            const centerX = 300;
            const centerY = 200;
            const length = 200;
            const radians = (faultParams.angle - 90) * Math.PI / 180;

            const x1 = centerX + Math.cos(radians) * length;
            const y1 = centerY + Math.sin(radians) * length;
            const x2 = centerX - Math.cos(radians) * length;
            const y2 = centerY - Math.sin(radians) * length;

            fault.setAttribute('d', `M${x1},${y1} L${x2},${y2}`);
        }

        function calculateDisplacement(x, y) {
            if (x <= 300) return { dx: 0, dy: 0 };

            const displacement = faultParams.displacement * progress;

            switch(faultParams.type) {
                case 'normal':
                    return {
                        dx: Math.sin(faultParams.angle * Math.PI / 180) * displacement,
                        dy: Math.cos(faultParams.angle * Math.PI / 180) * displacement
                    };
                case 'reverse':
                    return {
                        dx: -Math.sin(faultParams.angle * Math.PI / 180) * displacement,
                        dy: -Math.cos(faultParams.angle * Math.PI / 180) * displacement
                    };
                case 'strike-slip':
                    return {
                        dx: displacement,
                        dy: 0
                    };
                default:
                    return { dx: 0, dy: displacement };
            }
        }

        function createPath(offset) {
            const points = [];
            for (let x = 0; x <= 600; x += 10) {
                const y = 200 + offset + Math.sin((x - 300) / 100) * 50;
                points.push(`${x},${y}`);
            }
            return `M${points.join(' L')}`;
        }

        function initializeParticles() {
            particles = [];
            for (let i = 0; i < 50; i++) {
                const x = 250 + Math.random() * 100;
                const y = 200 + Math.sin((x - 300) / 100) * 50;

                if (i < 15) {
                    particles.push(new Particle(x, y - 20, 'gas'));
                } else if (i < 35) {
                    particles.push(new Particle(x, y, 'oil'));
                } else {
                    particles.push(new Particle(x, y + 20, 'water'));
                }
            }
        }

        function initializeLayers() {
            document.getElementById('layers').innerHTML = '';
            document.getElementById('reservoir').innerHTML = '';
            document.getElementById('particles').innerHTML = '';
            paths = [];

            const reservoir = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            reservoir.setAttribute('d', createPath(0));
            reservoir.setAttribute('fill', 'none');
            reservoir.setAttribute('stroke', '#FFE5B4');
            reservoir.setAttribute('stroke-width', '40');
            document.getElementById('reservoir').appendChild(reservoir);

            for (let i = 0; i < numLayers; i++) {
                const offset = i * 20 - 60;
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', createPath(offset));
                path.setAttribute('fill', 'none');
                path.setAttribute('stroke', colors[i]);
                path.setAttribute('stroke-width', '3');
                document.getElementById('layers').appendChild(path);
                paths.push(path);
            }

            initializeParticles();
            updateFaultLine();
        }

        function updateParticles() {
            const particlesGroup = document.getElementById('particles');
            particlesGroup.innerHTML = '';

            particles.forEach(particle => {
                particle.update();
                const disp = calculateDisplacement(particle.x, particle.y);
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', particle.x + disp.dx);
                circle.setAttribute('cy', particle.y + disp.dy);
                circle.setAttribute('r', particle.radius);
                circle.setAttribute('fill', particle.color);
                particlesGroup.appendChild(circle);
            });
        }

        function animate() {
            if (progress >= 1) {
                cancelAnimationFrame(animationFrame);
                return;
            }

            progress += 0.005;
            updateLayers();
            updateParticles();
            animationFrame = requestAnimationFrame(animate);
        }

        function updateLayers() {
            const fault = document.getElementById('fault');
            fault.style.opacity = progress;

            const allPaths = [...document.getElementById('reservoir').getElementsByTagName('path'),
                            ...document.getElementById('layers').getElementsByTagName('path')];

            allPaths.forEach((path, i) => {
                const offset = (i - 1) * 20 - 60;
                const points = [];

                for (let x = 0; x <= 600; x += 10) {
                    let y = 200 + offset + Math.sin((x - 300) / 100) * 50;

                    const disp = calculateDisplacement(x, y);
                    if (x > 300) {
                        x += disp.dx;
                        y += disp.dy;
                    }
                    points.push(`${x},${y}`);
                }

                path.setAttribute('d', `M${points.join(' L')}`);
            });
        }

        function startAnimation() {
            if (progress < 1) {
                animate();
            }
        }

        function resetAnimation() {
            progress = 0;
            cancelAnimationFrame(animationFrame);
            initializeLayers();
            document.getElementById('fault').style.opacity = 0;
        }

        // Initialize on load
        initializeLayers();
    </script>
</body>
</html>